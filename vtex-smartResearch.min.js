/**
*	Pesquisa Inteligente
*	@description Execurar buscas sem recarregar a página
*	@author Carlos Vinicius
*	@contributor Edson Domingos Júnior
*	@contributor Davi Guimarães
*	@version 3.11
*	@date 2018-09-12
*/
!function(q,O,U){"function"!=typeof String.prototype.replaceSpecialChars&&(String.prototype.replaceSpecialChars=function(){var t={"ç":"c","æ":"ae","œ":"oe","á":"a","é":"e","í":"i","ó":"o","ú":"u","à":"a","è":"e","ì":"i","ò":"o","ù":"u","ä":"a","ë":"e","ï":"i","ö":"o","ü":"u","ÿ":"y","â":"a","ê":"e","î":"i","ô":"o","û":"u","å":"a","ã":"a","ø":"o","õ":"o",u:"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","Ê":"E","Ô":"O","Ü":"U","Ã":"A","Õ":"O","À":"A","Ç":"C"};return this.replace(/[\u00e0-\u00fa]/g,function(e){return void 0!==t[e]?t[e]:e})}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),jQuery.fn.vtexSmartResearch=function(e){var r=jQuery(this),n=function(e,t){"object"==typeof console&&console.log("[Smart Research - "+(t||"Erro")+"] "+e)},t={pageLimit:null,loadContent:".prateleira[id^=ResultItems]",shelfClass:".prateleira",filtersMenu:".search-multiple-navigator",linksMenu:".search-single-navigator",menuDepartament:".navigation .menu-departamento",mergeMenu:!0,insertMenuAfter:".search-multiple-navigator h3:first",emptySearchElem:jQuery('<div class="vtexsr-emptySearch"></div>'),elemLoading:'<div id="scrollLoading">Carregando ... </div>',returnTopText:'<span class="text">voltar ao</span><span class="text2">TOPO</span>',emptySearchMsg:"<h3>Esta combinação de filtros não retornou nenhum resultado!</h3>",alertFilterErro:!0,filterErrorMsg:"Houve um erro ao tentar filtrar a página!",searchUrl:null,usePopup:!1,showLinks:!0,popupAutoCloseSeconds:3,filterOnChange:!0,filterButtonClass:".filter-btn",clearButtonClass:".clear-filter-btn",infinitScroll:!0,loadMoreText:"Carregar mais",filterScrollTop:function(e){return e.top-20},callback:function(){},getShelfHeight:function(e){return e.scrollTop()+e.height()},shelfCallback:function(){},ajaxCallback:function(){},emptySearchCallback:function(){},authorizeScroll:function(){return!0},authorizeUpdate:function(){return!0},labelCallback:function(e){}},i=jQuery.extend(t,e),a=jQuery(""),o=jQuery(i.elemLoading),s=2,l=!0,u=jQuery(O),c=(jQuery(q),jQuery("html,body")),f=jQuery("body"),p="",d="",h="",m=!1,v=jQuery(i.loadContent),g=jQuery(i.filtersMenu),y={requests:0,filters:0,isEmpty:!1},C={},b=function(e){return e||!1?p.replace(/PageNumber=[0-9]*/,"PageNumber="+s):(h+d).replace(/PageNumber=[0-9]*/,"PageNumber="+A)},j=function(){var e,t,r;return jQuery("script:not([src])").each(function(){if(t=jQuery(this)[0].innerHTML,r=/\/buscapagina\?.+&PageNumber=/i,-1<t.search(/\/buscapagina\?/i))return e=r.exec(t),!1}),void 0!==e&&void 0!==e[0]?e[0]:(n("Não foi possível localizar a url de busca da página.\n Tente adicionar o .js ao final da página. \n[Método: getSearchUrl]"),"")},x=function(){var e=f.find("#returnToTop");e.length<1&&(e=jQuery('<div id="returnToTop"><a href="#">'+i.returnTopText+'<span class="arrowToTop"></span></a></div>'),f.append(e));var t=u.height();u.bind("resize",function(){t=u.height()}),u.bind("scroll",function(){u.scrollTop()>t?e.stop(!0).fadeTo(300,1,function(){e.show()}):e.stop(!0).fadeTo(300,0,function(){e.hide()})}),e.bind("click",function(){return c.animate({scrollTop:0},"slow"),!1})},S=function(t){u.on("scroll",function(){var e=jQuery(this);if(!t.isDisponivelParaNovaBusca()||!i.authorizeScroll(y))return!1;e.scrollTop()+e.height()>=i.getShelfHeight(v)&&t.proxima()})},T=function(e){var t=U("<div />",{class:"load-more"}).insertAfter(v),r=U("<button />",{class:"btn",text:i.loadMoreText}).appendTo(t);r.click(function(){e.isDisponivelParaNovaBusca()&&e.proxima()}),U(O).on("vsr-request-init",function(){r.prop("disabled",!0).addClass("loading"),!r.is(":visible")&&l&&r.fadeIn()}),U(O).on("vsr-contagem-produtos",function(e,t){parseInt(t)<=v.find("li[layout]").length&&r.fadeOut()}),U(O).on("vsr-no-more-results",function(){r.fadeOut()}),U(O).on("vsr-more-results",function(){r.fadeIn()}),U(O).on("vsr-request-init",function(){r.prop("disabled",!1).removeClass("loading")})},Q=function(e,t,r){null!=e&&U(t=t||g).trigger(e,r)},M=function(){var n,a=!0;n=parseInt(function(e,t){t||(t=O.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}("cc",j())),U(O).on("vsr-no-more-results",function(){l=!1}),U(O).on("vsr-more-results",function(){l=!0});var e={isDisponivelParaNovaBusca:function(){return!m&&s<=e.getTotalPaginas()&&l},getTotalPaginas:function(){var e;if(null!==i.pageLimit)return i.pageLimit;e=(f.find(".pager:first").attr("id")||"").split("_").pop();var t=O["pagecount_"+e];return void 0===t&&(t=99999999),t},proxima:function(){if(!a)return null;var r=v.find(i.shelfClass).filter(":last");r.after(o),a=!1,Q("vsr-request-init",v),w=jQuery.ajax({url:b(!0),success:function(e){var t=U(e).find("li[layout]").length;0<t&&r.after(e),Q(0<t&&t==n?"vsr-more-results":"vsr-no-more-results",u),a=!0,o.remove(),y.requests++,i.ajaxCallback(y),Q("vsr-ajax-sucess")},complete:function(){Q("vsr-request-end",v)}}),s++}};return e}();if(p=h=null!==i.searchUrl?i.searchUrl:j(),r.length<1)return n("Nenhuma opção de filtro encontrada","Aviso"),i.showLinks&&jQuery(i.linksMenu).css("visibility","visible").show(),i.infinitScroll?S(M):T(M),x(),r;if(v.length<1)return n("Elemento para destino da requisição não foi encontrado \n ("+v.selector+")"),!1;g.length<1&&n("O menu de filtros não foi encontrado \n ("+g.selector+")");q.location.href;var k=jQuery(i.linksMenu),E=jQuery('<div class="vtexSr-overlay"></div>'),P=jQuery(i.menuDepartament),F=v.offset(),A=1,_=null,w=null;i.emptySearchElem.append(i.emptySearchMsg),v.before(E);var L={exec:function(){L.setFilterMenu(),L.fieldsetFormat(),r.each(function(){var e=jQuery(this),t=e.parent();e.is(":checked")&&(d+="&"+(e.attr("rel")||""),t.addClass("sr_selected")),L.adjustText(e),t.append('<span class="sr_box"></span><span class="sr_box2"></span>'),e.bind("change",function(){L.inputAction(),e.is(":checked")?L.addFilter(e):L.removeFilter(e),i.filterOnChange&&(y.filters=r.filter(":checked").length)})}),jQuery(i.filterButtonClass).on("click",function(){L.applyFilter()}),jQuery(i.clearButtonClass).on("click",function(e){L.removeAllFilters(e,this)}),""!==d&&L.addFilter(a),L.contadorDeProdutos(),L.atualizarPaginador(),Q("vsr-complete")},mergeMenu:function(){if(!i.mergeMenu)return!1;var e=P;e.insertAfter(i.insertMenuAfter),L.departamentMenuFormat(e)},mergeMenuList:function(){var t=0;g.find("h3,h4").each(function(){var e=k.find("h3,h4").eq(t).next("ul");e.insertAfter(jQuery(this)),L.departamentMenuFormat(e),t++})},departamentMenuFormat:function(e){e.find("a").each(function(){var e=jQuery(this);e.text(L.removeCounter(e.text()))})},fieldsetFormat:function(){C.fieldsetCount=0,C.tmpCurrentLabel={},g.find("fieldset").each(function(){var a=jQuery(this),e=a.find("label"),o="filtro_"+(a.find("h5:first").text()||"").toLowerCase().replaceSpecialChars().replace(/\s/g,"-");C[o]={},e.length<1?a.hide():(a.addClass(o),e.each(function(e){var t=jQuery(this),r=t.find("input").val()||"",n="sr_"+r.toLowerCase().replaceSpecialChars().replace(/\s/g,"-");C.tmpCurrentLabel={fieldsetParent:[a,o],elem:t},C[o][e.toString()]={className:n,title:r},t.addClass(n).attr({title:r,index:e}),i.labelCallback(C)}),C.fieldsetCount++)})},inputAction:function(){null!==w&&w.abort(),null!==_&&_.abort(),s=2,l=!0},applyFilter:function(){p=b(),Q("vsr-request-init",v,p),_=jQuery.ajax({url:p,success:L.filterAjaxSuccess,error:L.filterAjaxError,complete:function(){Q("vsr-request-end",v)}})},addFilter:function(e){d+="&"+(e.attr("rel")||""),p=b(),i.filterOnChange&&(E.fadeTo(300,.6),L.applyFilter(),Q("vsr-add-filter")),e.parent().addClass("sr_selected")},removeAllFilters:function(e,t){d="",U("input:checked").prop("checked",!1).parent().removeClass("sr_selected"),L.applyFilter(),Q("vsr-clean-all-filter")},removeFilter:function(e){var t=e.attr("rel")||"";""!==t&&(d=d.replace("&"+t,"")),i.filterOnChange&&(E.fadeTo(300,.6),L.applyFilter(),Q("vsr-remove-filter")),e.parent().removeClass("sr_selected")},filterAjaxSuccess:function(e){var t=jQuery(e);E.fadeTo(300,0,function(){jQuery(this).hide()}),L.updateContent(t),y.requests++,i.ajaxCallback(y),c.animate({scrollTop:i.filterScrollTop(F||{top:0,left:0})},600),Q("vsr-ajax-sucess")},filterAjaxError:function(){E.fadeTo(300,0,function(){jQuery(this).hide()}),i.alertFilterErro&&alert(i.filterErrorMsg),n("Houve um erro ao tentar fazer a requisição da página com filtros."),Q("vsr-ajax-fail")},updateContent:function(e){if(m=!0,!i.authorizeUpdate(y))return!1;var t=e.filter(i.shelfClass),r=v.find(i.shelfClass);(0<r.length?r:i.emptySearchElem).slideUp(600,function(){jQuery(this).remove(),i.usePopup?f.find(".boxPopUp2").vtexPopUp2():i.emptySearchElem.remove(),0<t.length?(t.hide(),v.append(t),i.shelfCallback(),t.slideDown(600,function(){m=!1}),y.isEmpty=!1):(y.isEmpty=!0,i.usePopup?i.emptySearchElem.addClass("freeContent autoClose ac_"+i.popupAutoCloseSeconds).vtexPopUp2().stop(!0).show():(v.append(i.emptySearchElem),i.emptySearchElem.show().css("height","auto").fadeTo(300,.2,function(){i.emptySearchElem.fadeTo(300,1)})),i.emptySearchCallback(y))})},adjustText:function(e){var t=e.parent(),r=t.text();r=L.removeCounter(r),t.text(r).prepend(e)},removeCounter:function(e){return e.replace(/\([0-9]+\)/gi,function(e){return""})},setFilterMenu:function(){0<g.length&&(k.hide(),g.show())},atualizarPaginador:function(){U(O).on("vsr-contagem-produtos",function(e,t){var r=parseInt(t),n=v.find("li[layout]").length;Q(r<=n?"vsr-no-more-results":"vsr-more-results",u)})},contadorDeProdutos:function(){U(O).on("vsr-request-init",function(e,t){U(O).one("vsr-request-end",function(e,t){var r="/api/catalog_system/pub/products/search"+p.replace("/buscapagina","");-1!==r.indexOf("?")?r+="&_from=1&_to=1":r+="?_from=1&_to=1",U.get(r).done(function(e,t,r){var n=r.getResponseHeader("resources").split("/"),a=0;1<n.length&&(a=n[1]),setTimeout(function(){Q("vsr-contagem-produtos",v,a)},200)}).fail()})})}};f.hasClass("departamento")?L.mergeMenu():(f.hasClass("categoria")||f.hasClass("resultado-busca"))&&L.mergeMenuList(),L.exec(),i.infinitScroll?S(M):T(M),x(),i.callback(),g.css("visibility","visible")}}(document,window,jQuery);