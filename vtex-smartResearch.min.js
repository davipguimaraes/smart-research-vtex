"function"!=typeof String.prototype.replaceSpecialChars&&(String.prototype.replaceSpecialChars=function(){var e={"ç":"c","æ":"ae","œ":"oe","á":"a","é":"e","í":"i","ó":"o","ú":"u","à":"a","è":"e","ì":"i","ò":"o","ù":"u","ä":"a","ë":"e","ï":"i","ö":"o","ü":"u","ÿ":"y","â":"a","ê":"e","î":"i","ô":"o","û":"u","å":"a","ã":"a","ø":"o","õ":"o",u:"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","Ê":"E","Ô":"O","Ü":"U","Ã":"A","Õ":"O","À":"A","Ç":"C"};return this.replace(/[\u00e0-\u00fa]/g,function(t){return void 0!==e[t]?e[t]:t})}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),jQuery.fn.vtexSmartResearch=function(e){$this=jQuery(this);var t=function(e,t){"object"==typeof console&&console.log("[Smart Research - "+(t||"Erro")+"] "+e)},r={pageLimit:null,loadContent:".prateleira[id^=ResultItems]",shelfClass:".prateleira",filtersMenu:".search-multiple-navigator",linksMenu:".search-single-navigator",menuDepartament:".navigation .menu-departamento",mergeMenu:!0,insertMenuAfter:".search-multiple-navigator h3:first",emptySearchElem:jQuery('<div class="vtexsr-emptySearch"></div>'),elemLoading:'<div id="scrollLoading">Carregando ... </div>',returnTopText:'<span class="text">voltar ao</span><span class="text2">TOPO</span>',emptySearchMsg:"<h3>Esta combinação de filtros não retornou nenhum resultado!</h3>",filterErrorMsg:"Houve um erro ao tentar filtrar a página!",searchUrl:null,usePopup:!1,showLinks:!0,popupAutoCloseSeconds:3,filterOnChange:!0,filterButtonClass:".filter-btn",clearButtonClass:".clear-filter-btn",filterScrollTop:function(e){return e.top-20},callback:function(){},getShelfHeight:function(e){return e.scrollTop()+e.height()},shelfCallback:function(){},ajaxCallback:function(){},emptySearchCallback:function(){},authorizeScroll:function(){return!0},authorizeUpdate:function(){return!0},labelCallback:function(e){}},n=jQuery.extend(r,e),a=jQuery(""),i=jQuery(n.elemLoading),o=2,l=!0,s=jQuery(window),u=(jQuery(document),jQuery("html,body")),c=jQuery("body"),p="",f="",d="",h=!1,m=jQuery(n.loadContent),g=jQuery(n.filtersMenu),y={requests:0,filters:0,isEmpty:!1},v={},C={getUrl:function(e){return e||!1?p.replace(/PageNumber=[0-9]*/,"PageNumber="+o):(d+f).replace(/PageNumber=[0-9]*/,"PageNumber="+x)},getSearchUrl:function(){var e,r,n;return jQuery("script:not([src])").each(function(){if(r=jQuery(this)[0].innerHTML,n=/\/buscapagina\?.+&PageNumber=/i,r.search(/\/buscapagina\?/i)>-1)return e=n.exec(r),!1}),void 0!==e&&void 0!==e[0]?e[0]:(t("Não foi possível localizar a url de busca da página.\n Tente adicionar o .js ao final da página. \n[Método: getSearchUrl]"),"")},scrollToTop:function(){var e=c.find("#returnToTop");e.length<1&&(e=jQuery('<div id="returnToTop"><a href="#">'+n.returnTopText+'<span class="arrowToTop"></span></a></div>'),c.append(e));var t=s.height();s.bind("resize",function(){t=s.height()}),s.bind("scroll",function(){s.scrollTop()>t?e.stop(!0).fadeTo(300,1,function(){e.show()}):e.stop(!0).fadeTo(300,0,function(){e.hide()})}),e.bind("click",function(){return u.animate({scrollTop:0},"slow"),!1})},infinitScroll:function(){var e,r,a;a=(c.find(".pager:first").attr("id")||"").split("_").pop(),e=null!==n.pageLimit?n.pageLimit:window["pagecount_"+a],r=!0,void 0===e&&(e=99999999),s.bind("scroll",function(){var a=jQuery(this);if(!(!h&&o<=e&&l&&n.authorizeScroll(y)))return!1;if(a.scrollTop()+a.height()>=n.getShelfHeight(m)&&r){var s=m.find(n.shelfClass).filter(":last");s.after(i),r=!1,M=jQuery.ajax({url:C.getUrl(!0),success:function(e){e.trim().length<1?(l=!1,t("Não existem mais resultados a partir da página: "+(o-1),"Aviso")):s.after(e),r=!0,i.remove(),y.requests++,n.ajaxCallback(y)}}),o++}})}};if(p=d=null!==n.searchUrl?n.searchUrl:C.getSearchUrl(),$this.length<1)return t("Nenhuma opção de filtro encontrada","Aviso"),n.showLinks&&jQuery(n.linksMenu).css("visibility","visible").show(),C.infinitScroll(),C.scrollToTop(),$this;if(m.length<1)return t("Elemento para destino da requisição não foi encontrado \n ("+m.selector+")"),!1;g.length<1&&t("O menu de filtros não foi encontrado \n ("+g.selector+")");document.location.href;var b=jQuery(n.linksMenu),j=jQuery('<div class="vtexSr-overlay"></div>'),S=jQuery(n.menuDepartament),T=m.offset(),x=1,Q=null,M=null;n.emptySearchElem.append(n.emptySearchMsg),m.before(j);var k={exec:function(){k.setFilterMenu(),k.fieldsetFormat(),$this.each(function(){var e=jQuery(this),t=e.parent();e.is(":checked")&&(f+="&"+(e.attr("rel")||""),t.addClass("sr_selected")),k.adjustText(e),t.append('<span class="sr_box"></span><span class="sr_box2"></span>'),e.bind("change",function(){k.inputAction(),e.is(":checked")?k.addFilter(e):k.removeFilter(e),n.filterOnChange&&(y.filters=$this.filter(":checked").length)})}),jQuery(n.filterButtonClass).on("click",function(){k.applyFilter()}),jQuery(n.clearButtonClass).on("click",function(){k.clearFilter()}),""!==f&&k.addFilter(a)},mergeMenu:function(){if(!n.mergeMenu)return!1;var e=S;e.insertAfter(n.insertMenuAfter),k.departamentMenuFormat(e)},mergeMenuList:function(){var e=0;g.find("h3,h4").each(function(){var t=b.find("h3,h4").eq(e).next("ul");t.insertAfter(jQuery(this)),k.departamentMenuFormat(t),e++})},departamentMenuFormat:function(e){e.find("a").each(function(){var e=jQuery(this);e.text(k.removeCounter(e.text()))})},fieldsetFormat:function(){v.fieldsetCount=0,v.tmpCurrentLabel={},g.find("fieldset").each(function(){var e=jQuery(this),t=e.find("label"),r="filtro_"+(e.find("h5:first").text()||"").toLowerCase().replaceSpecialChars().replace(/\s/g,"-");v[r]={},t.length<1?e.hide():(e.addClass(r),t.each(function(t){var a=jQuery(this),i=a.find("input").val()||"",o="sr_"+i.toLowerCase().replaceSpecialChars().replace(/\s/g,"-");v.tmpCurrentLabel={fieldsetParent:[e,r],elem:a},v[r][t.toString()]={className:o,title:i},a.addClass(o).attr({title:i,index:t}),n.labelCallback(v)}),v.fieldsetCount++)})},inputAction:function(){null!==M&&M.abort(),null!==Q&&Q.abort(),o=2,l=!0},applyFilter:function(){p=C.getUrl(),Q=jQuery.ajax({url:p,success:k.filterAjaxSuccess,error:k.filterAjaxError})},addFilter:function(e){f+="&"+(e.attr("rel")||""),p=C.getUrl(),n.filterOnChange&&(j.fadeTo(300,.6),k.applyFilter()),e.parent().addClass("sr_selected")},clearFilter:function(){f="",k.applyFilter()},removeFilter:function(e){var t=e.attr("rel")||"";""!==t&&(f=f.replace("&"+t,"")),n.filterOnChange&&(j.fadeTo(300,.6),k.applyFilter()),e.parent().removeClass("sr_selected")},filterAjaxSuccess:function(e){var t=jQuery(e);j.fadeTo(300,0,function(){jQuery(this).hide()}),k.updateContent(t),y.requests++,n.ajaxCallback(y),u.animate({scrollTop:n.filterScrollTop(T||{top:0,left:0})},600)},filterAjaxError:function(){j.fadeTo(300,0,function(){jQuery(this).hide()}),alert(n.filterErrorMsg),t("Houve um erro ao tentar fazer a requisição da página com filtros.")},updateContent:function(e){if(h=!0,!n.authorizeUpdate(y))return!1;var t=e.filter(n.shelfClass),r=m.find(n.shelfClass);(r.length>0?r:n.emptySearchElem).slideUp(600,function(){jQuery(this).remove(),n.usePopup?c.find(".boxPopUp2").vtexPopUp2():n.emptySearchElem.remove(),t.length>0?(t.hide(),m.append(t),n.shelfCallback(),t.slideDown(600,function(){h=!1}),y.isEmpty=!1):(y.isEmpty=!0,n.usePopup?n.emptySearchElem.addClass("freeContent autoClose ac_"+n.popupAutoCloseSeconds).vtexPopUp2().stop(!0).show():(m.append(n.emptySearchElem),n.emptySearchElem.show().css("height","auto").fadeTo(300,.2,function(){n.emptySearchElem.fadeTo(300,1)})),n.emptySearchCallback(y))})},adjustText:function(e){var t=e.parent(),r=t.text();qtt="",r=k.removeCounter(r),t.text(r).prepend(e)},removeCounter:function(e){return e.replace(/\([0-9]+\)/gi,function(e){return qtt=e.replace(/\(|\)/,""),""})},setFilterMenu:function(){g.length>0&&(b.hide(),g.show())}};c.hasClass("departamento")?k.mergeMenu():(c.hasClass("categoria")||c.hasClass("resultado-busca"))&&k.mergeMenuList(),k.exec(),C.infinitScroll(),C.scrollToTop(),n.callback(),g.css("visibility","visible")};