/**
*	Pesquisa Inteligente
*	@description Execurar buscas sem recarregar a página
*	@author Carlos Vinicius
*	@contributor Edson Domingos Júnior
*	@contributor Davi Guimarães
*	@version 3.11
*	@date 2018-09-12
*/
"function"!=typeof String.prototype.replaceSpecialChars&&(String.prototype.replaceSpecialChars=function(){var t={"ç":"c","æ":"ae","œ":"oe","á":"a","é":"e","í":"i","ó":"o","ú":"u","à":"a","è":"e","ì":"i","ò":"o","ù":"u","ä":"a","ë":"e","ï":"i","ö":"o","ü":"u","ÿ":"y","â":"a","ê":"e","î":"i","ô":"o","û":"u","å":"a","ã":"a","ø":"o","õ":"o",u:"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","Ê":"E","Ô":"O","Ü":"U","Ã":"A","Õ":"O","À":"A","Ç":"C"};return this.replace(/[\u00e0-\u00fa]/g,function(e){return void 0!==t[e]?t[e]:e})}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),jQuery.fn.vtexSmartResearch=function(e){var r,t,n=jQuery(this),a=function(e,t){"object"==typeof console&&console.log("[Smart Research - "+(t||"Erro")+"] "+e)},i={pageLimit:null,loadContent:".prateleira[id^=ResultItems]",shelfClass:".prateleira",filtersMenu:".search-multiple-navigator",linksMenu:".search-single-navigator",menuDepartament:".navigation .menu-departamento",mergeMenu:!0,insertMenuAfter:".search-multiple-navigator h3:first",emptySearchElem:jQuery('<div class="vtexsr-emptySearch"></div>'),elemLoading:'<div id="scrollLoading">Carregando ... </div>',returnTopText:'<span class="text">voltar ao</span><span class="text2">TOPO</span>',emptySearchMsg:"<h3>Esta combinação de filtros não retornou nenhum resultado!</h3>",alertFilterErro:!0,filterErrorMsg:"Houve um erro ao tentar filtrar a página!",searchUrl:null,usePopup:!1,showLinks:!0,popupAutoCloseSeconds:3,filterOnChange:!0,filterButtonClass:".filter-btn",clearButtonClass:".clear-filter-btn",infinitScroll:!0,loadMoreText:"Carregar mais",filterScrollTop:function(e){return e.top-20},callback:function(){},getShelfHeight:function(e){return e.scrollTop()+e.height()},shelfCallback:function(){},ajaxCallback:function(){},emptySearchCallback:function(){},authorizeScroll:function(){return!0},authorizeUpdate:function(){return!0},labelCallback:function(e){}},o=jQuery.extend(i,e),l=jQuery(""),s=jQuery(o.elemLoading),u=2,c=!0,f=jQuery(window),p=(jQuery(document),jQuery("html,body")),d=jQuery("body"),h="",g="",m="",v=!1,y=jQuery(o.loadContent),C=jQuery(o.filtersMenu),b={requests:0,filters:0,isEmpty:!1},j={},x=function(e){return e||!1?h.replace(/PageNumber=[0-9]*/,"PageNumber="+u):(m+g).replace(/PageNumber=[0-9]*/,"PageNumber="+w)},S=function(){var e,t,r;return jQuery("script:not([src])").each(function(){if(t=jQuery(this)[0].innerHTML,r=/\/buscapagina\?.+&PageNumber=/i,-1<t.search(/\/buscapagina\?/i))return e=r.exec(t),!1}),void 0!==e&&void 0!==e[0]?e[0]:(a("Não foi possível localizar a url de busca da página.\n Tente adicionar o .js ao final da página. \n[Método: getSearchUrl]"),"")},T=function(){var e=d.find("#returnToTop");e.length<1&&(e=jQuery('<div id="returnToTop"><a href="#">'+o.returnTopText+'<span class="arrowToTop"></span></a></div>'),d.append(e));var t=f.height();f.bind("resize",function(){t=f.height()}),f.bind("scroll",function(){f.scrollTop()>t?e.stop(!0).fadeTo(300,1,function(){e.show()}):e.stop(!0).fadeTo(300,0,function(){e.hide()})}),e.bind("click",function(){return p.animate({scrollTop:0},"slow"),!1})},E=function(t){f.on("scroll",function(){var e=jQuery(this);if(!t.isDisponivelParaNovaBusca()||!o.authorizeScroll(b))return!1;e.scrollTop()+e.height()>=o.getShelfHeight(y)&&t.proxima()})},Q=function(e){var t=$("<div />",{class:"load-more"}).insertAfter(y),r=$("<button />",{class:"btn",text:o.loadMoreText}).appendTo(t);r.click(function(){e.isDisponivelParaNovaBusca()&&e.proxima()}),y.on("vsr-request-init",function(){r.prop("disabled",!0).addClass("loading"),!r.is(":visible")&&c&&r.fadeIn()}),y.on("vsr-request-end",function(){r.prop("disabled",!1).removeClass("loading"),c||r.fadeOut()})},M=(r=!0,t={isDisponivelParaNovaBusca:function(){return!v&&u<=t.getTotalPaginas()&&c},getTotalPaginas:function(){var e;if(null!==o.pageLimit)return o.pageLimit;e=(d.find(".pager:first").attr("id")||"").split("_").pop();var t=window["pagecount_"+e];return void 0===t&&(t=99999999),t},proxima:function(){if(!r)return null;var t=y.find(o.shelfClass).filter(":last");t.after(s),r=!1,N.triggerEvent("vsr-request-init",y),q=jQuery.ajax({url:x(!0),success:function(e){e.trim().length<1?(c=!1,a("Não existem mais resultados a partir da página: "+(u-1),"Aviso")):t.after(e),r=!0,s.remove(),b.requests++,o.ajaxCallback(b),N.triggerEvent("vsr-ajax-sucess")},complete:function(){N.triggerEvent("vsr-request-end",y)}}),u++}});if(h=m=null!==o.searchUrl?o.searchUrl:S(),n.length<1)return a("Nenhuma opção de filtro encontrada","Aviso"),o.showLinks&&jQuery(o.linksMenu).css("visibility","visible").show(),o.infinitScroll?E(M):Q(M),T(),n;if(y.length<1)return a("Elemento para destino da requisição não foi encontrado \n ("+y.selector+")"),!1;C.length<1&&a("O menu de filtros não foi encontrado \n ("+C.selector+")");document.location.href;var k=jQuery(o.linksMenu),F=jQuery('<div class="vtexSr-overlay"></div>'),A=jQuery(o.menuDepartament),P=y.offset(),w=1,L=null,q=null;o.emptySearchElem.append(o.emptySearchMsg),y.before(F);var N={exec:function(){N.setFilterMenu(),N.fieldsetFormat(),n.each(function(){var e=jQuery(this),t=e.parent();e.is(":checked")&&(g+="&"+(e.attr("rel")||""),t.addClass("sr_selected")),N.adjustText(e),t.append('<span class="sr_box"></span><span class="sr_box2"></span>'),e.bind("change",function(){N.inputAction(),e.is(":checked")?N.addFilter(e):N.removeFilter(e),o.filterOnChange&&(b.filters=n.filter(":checked").length)})}),jQuery(o.filterButtonClass).on("click",function(){N.applyFilter()}),jQuery(o.clearButtonClass).on("click",function(e){N.removeAllFilters(e,this)}),""!==g&&N.addFilter(l),N.triggerEvent("vsr-complete")},triggerEvent:function(e,t,r){null!=e&&(t=t||C,$(t).trigger(e,r))},mergeMenu:function(){if(!o.mergeMenu)return!1;var e=A;e.insertAfter(o.insertMenuAfter),N.departamentMenuFormat(e)},mergeMenuList:function(){var t=0;C.find("h3,h4").each(function(){var e=k.find("h3,h4").eq(t).next("ul");e.insertAfter(jQuery(this)),N.departamentMenuFormat(e),t++})},departamentMenuFormat:function(e){e.find("a").each(function(){var e=jQuery(this);e.text(N.removeCounter(e.text()))})},fieldsetFormat:function(){j.fieldsetCount=0,j.tmpCurrentLabel={},C.find("fieldset").each(function(){var a=jQuery(this),e=a.find("label"),i="filtro_"+(a.find("h5:first").text()||"").toLowerCase().replaceSpecialChars().replace(/\s/g,"-");j[i]={},e.length<1?a.hide():(a.addClass(i),e.each(function(e){var t=jQuery(this),r=t.find("input").val()||"",n="sr_"+r.toLowerCase().replaceSpecialChars().replace(/\s/g,"-");j.tmpCurrentLabel={fieldsetParent:[a,i],elem:t},j[i][e.toString()]={className:n,title:r},t.addClass(n).attr({title:r,index:e}),o.labelCallback(j)}),j.fieldsetCount++)})},inputAction:function(){null!==q&&q.abort(),null!==L&&L.abort(),u=2,c=!0},applyFilter:function(){h=x(),N.triggerEvent("vsr-request-init",y,h),L=jQuery.ajax({url:h,success:N.filterAjaxSuccess,error:N.filterAjaxError,complete:function(){N.triggerEvent("vsr-request-end",y)}})},addFilter:function(e){g+="&"+(e.attr("rel")||""),h=x(),o.filterOnChange&&(F.fadeTo(300,.6),N.applyFilter(),N.triggerEvent("vsr-add-filter")),e.parent().addClass("sr_selected")},removeAllFilters:function(e,t){g="",$("input:checked").prop("checked",!1).parent().removeClass("sr_selected"),N.applyFilter(),N.triggerEvent("vsr-clean-all-filter")},removeFilter:function(e){var t=e.attr("rel")||"";""!==t&&(g=g.replace("&"+t,"")),o.filterOnChange&&(F.fadeTo(300,.6),N.applyFilter(),N.triggerEvent("vsr-remove-filter")),e.parent().removeClass("sr_selected")},filterAjaxSuccess:function(e){var t=jQuery(e);F.fadeTo(300,0,function(){jQuery(this).hide()}),N.updateContent(t),b.requests++,o.ajaxCallback(b),p.animate({scrollTop:o.filterScrollTop(P||{top:0,left:0})},600),N.triggerEvent("vsr-ajax-sucess")},filterAjaxError:function(){F.fadeTo(300,0,function(){jQuery(this).hide()}),o.alertFilterErro&&alert(o.filterErrorMsg),a("Houve um erro ao tentar fazer a requisição da página com filtros."),N.triggerEvent("vsr-ajax-fail")},updateContent:function(e){if(v=!0,!o.authorizeUpdate(b))return!1;var t=e.filter(o.shelfClass),r=y.find(o.shelfClass);(0<r.length?r:o.emptySearchElem).slideUp(600,function(){jQuery(this).remove(),o.usePopup?d.find(".boxPopUp2").vtexPopUp2():o.emptySearchElem.remove(),0<t.length?(t.hide(),y.append(t),o.shelfCallback(),t.slideDown(600,function(){v=!1}),b.isEmpty=!1):(b.isEmpty=!0,o.usePopup?o.emptySearchElem.addClass("freeContent autoClose ac_"+o.popupAutoCloseSeconds).vtexPopUp2().stop(!0).show():(y.append(o.emptySearchElem),o.emptySearchElem.show().css("height","auto").fadeTo(300,.2,function(){o.emptySearchElem.fadeTo(300,1)})),o.emptySearchCallback(b))})},adjustText:function(e){var t=e.parent(),r=t.text();r=N.removeCounter(r),t.text(r).prepend(e)},removeCounter:function(e){return e.replace(/\([0-9]+\)/gi,function(e){return""})},setFilterMenu:function(){0<C.length&&(k.hide(),C.show())}};d.hasClass("departamento")?N.mergeMenu():(d.hasClass("categoria")||d.hasClass("resultado-busca"))&&N.mergeMenuList(),N.exec(),o.infinitScroll?E(M):Q(M),T(),o.callback(),C.css("visibility","visible")};